<section class="backend__customet-details container-fluid pl-0 pr-0 nomainlayout">
    <div class="row">
        <div class="col-12 mb-20">
            <div class="dtl-card-list">
                <div class="dtl-card">
                    <div class="card-styles">
                        <div class="card--main-block">
                            <div class="card_icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                                    <path
                                        d="m438-338 226-226-57-57-169 169-84-84-57 57 141 141Zm42 258q-139-35-229.5-159.5T160-516v-244l320-120 320 120v244q0 152-90.5 276.5T480-80Zm0-84q104-33 172-132t68-220v-189l-240-90-240 90v189q0 121 68 220t172 132Zm0-316Z" />
                                </svg>
                            </div>
                            <div class="card--main-content">
                                <h6>Total Policies</h6>
                                <p>{{policySaleList?.length}}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dtl-card">
                    <div class="card-styles">
                        <div class="card--main-block">
                            <div class="card_icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                                    <path
                                        d="M440-200h80v-40h40q17 0 28.5-11.5T600-280v-120q0-17-11.5-28.5T560-440H440v-40h160v-80h-80v-40h-80v40h-40q-17 0-28.5 11.5T360-520v120q0 17 11.5 28.5T400-360h120v40H360v80h80v40ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Zm280-560v-160H240v640h480v-480H520ZM240-800v160-160 640-640Z" />
                                </svg>
                            </div>
                            <div class="card--main-content">
                                <h6>Policy Value</h6>
                                <p>{{totalPolicyAmount| currency:'USD'}}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dtl-card">
                    <div class="card-styles">
                        <div class="card--main-block">
                            <div class="card_icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                                    <path
                                        d="M570-104q-23 23-57 23t-57-23L104-456q-11-11-17.5-26T80-514v-286q0-33 23.5-56.5T160-880h286q17 0 32 6.5t26 17.5l352 353q23 23 23 56.5T856-390L570-104Zm-57-56 286-286-353-354H160v286l353 354ZM260-640q25 0 42.5-17.5T320-700q0-25-17.5-42.5T260-760q-25 0-42.5 17.5T200-700q0 25 17.5 42.5T260-640ZM160-800Z" />
                                </svg>
                            </div>
                            <div class="card--main-content">
                                <h6>Total Claim</h6>
                                <p>{{claimCount}}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dtl-card">
                    <div class="card-styles">
                        <div class="card--main-block">
                            <div class="card_icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                                    <path
                                        d="m424-296 282-282-56-56-226 226-114-114-56 56 170 170Zm56 216q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" />
                                </svg>
                            </div>
                            <div class="card--main-content">
                                <h6>Active Claim</h6>
                                <p>{{claimCount}}</p>  
                            </div>
                        </div>
                    </div>
                </div>


                <div class="dtl-card">
                    <div class="card-styles">
                        <div class="card--main-block">
                            <div class="card_icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                                    <path
                                        d="M560-440q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM280-320q-33 0-56.5-23.5T200-400v-320q0-33 23.5-56.5T280-800h560q33 0 56.5 23.5T920-720v320q0 33-23.5 56.5T840-320H280Zm80-80h400q0-33 23.5-56.5T840-480v-160q-33 0-56.5-23.5T760-720H360q0 33-23.5 56.5T280-640v160q33 0 56.5 23.5T360-400Zm440 240H120q-33 0-56.5-23.5T40-240v-440h80v440h680v80ZM280-400v-320 320Z" />
                                </svg>
                            </div>
                            <div class="card--main-content">
                                <h6>Premium Balance</h6>
                                <p>{{totalPremiumAmount| currency:'USD'}}</p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="dtl-card">
                    <div class="card-styles">
                        <div class="card--main-block">
                            <div class="card_icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
                                    <path
                                        d="M160-640h640v-80H160v80Zm-80-80q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v240H160v240h164v80H160q-33 0-56.5-23.5T80-240v-480ZM598-80 428-250l56-56 114 112 226-226 56 58L598-80ZM160-720v480-180 113-413Z" />
                                </svg>
                            </div>
                            <div class="card--main-content">
                                <h6>Premium Paid</h6>
                                <p>{{totalPremiumPaidAmount| currency:'USD'}}</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="row">
     <div class="col-12">
            <div class="detil_hdng">
                <h3>Salesman Details</h3>
            </div>
            <div class="card-styles card--customer-info">

                <div class="detls_wrap">
                    <div class="customer-img">
                        <img src="./assets/img/people.png" alt="" title="" />
                    </div>
                    <h5 class="fw-semibold">{{salesmanDetails?.first_name}} {{salesmanDetails?.last_name}}</h5>
                </div>
           
                <div class="detls_table">
                    <div class="detls_item">
                        <table>
                            <tbody>
                                <tr>
                                    <td><span class="pl-0">Email:</span>
                                        <span class="pl-0">{{salesmanDetails?.email}}</span>
                                    </td>
                                </tr>
                                
                            <tr>
                                <td><span class="pl-0">Alternate Phone No.:</span>
                                    <span class="pl-0">{{salesmanDetails?.alternate_phone?(salesmanDetails?.alternate_phone|phoneUsFormat):'NA'}}</span>
                                </td>
                            </tr>
                            <tr>
                                <td><span class="pl-0">State:</span>
                                    <span class="pl-0">{{salesmanDetails?.state?salesmanDetails?.state:'NA'}}</span>
                                </td>
                            </tr>
                                <tr>
                                    <td><span class="pl-0">Address:</span>
                                        <span class="pl-0">{{salesmanDetails?.address1?salesmanDetails?.address1:'NA'}}</span>
                                    </td>
                                </tr>
                                
                            </tbody>
                        </table>
                    </div>
                    <div class="detls_item">
                        <table>
                            <tr>
                                <td><span class="pl-0">Phone No.:</span>
                                    <span class="pl-0">{{salesmanDetails?.mobile|phoneUsFormat}}</span>
                                </td>
                            </tr>
                            <tr>
                                <td><span class="pl-0">Zip Code:</span>
                                    <span class="pl-0">{{salesmanDetails?.zip?salesmanDetails?.zip:'NA'}}</span>
                                </td>
                            </tr>
                            <tr>
                                <td><span class="pl-0">City:</span>
                                    <span class="pl-0">{{salesmanDetails?.city}}</span> 
                                </td>
                            </tr>
                            <tr>
                                <td><span class="pl-0">Source:</span>
                                    <span class="pl-0">{{salesmanDetails?.source==0?"Self Customer":"Backend Team"}}</span>
                                </td>
                            </tr>
                            
                            
                        </table>
                    </div>
                   
                </div>
                <div class="detls_posted">
                    <div class="detls_posted_itm">
                       <p>Created On: <span>{{salesmanDetails?.created_at |date:"MM-dd-YYYY"}}</span> by</p> 
                       <p>
                        <span *ngIf="salesmanDetails?.created_user_info">{{salesmanDetails?.created_user_info?.first_name}}
                            {{salesmanDetails?.created_user_info?.last_name}}</span> 
                        <span *ngIf="!salesmanDetails?.created_user_info">N/A</span>
                       </p>
                        
                    </div>
                    <div class="detls_posted_itm">
                        <p>Updated On: <span>{{salesmanDetails?.updated_at |date:"MM-dd-YYYY"}}</span> by</p> 
                        <p>
                            <span *ngIf="salesmanDetails?.updated_user_info">{{salesmanDetails?.updated_user_info?.first_name}}
                                        {{salesmanDetails?.updated_user_info?.last_name}}</span>
                                    <span *ngIf="!salesmanDetails?.updated_user_info">N/A</span>
                           </p>
                     </div>
                    
                </div>
            </div>
        </div> 
    </div>
    <div class="row">
        <div class="col-12">
            <div class="detil_hdng">
                <h3>Policy and Payment Details</h3>
            </div>

            <div class="card--tab-contents">
                <!-- Nav tabs -->
                <div class="card-styles p-0">
                    <ul class="nav nav-tabs nav-fill fw--bold" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="nav-link-tab__1" data-bs-toggle="tab"
                                data-bs-target="#tab-pane__tab-1" type="button" role="tab" aria-controls="tab-1"
                                aria-selected="true">Policies</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="nav-link-tab__3" data-bs-toggle="tab" 
                            data-bs-target="#tab-pane__tab-3" type="button" role="tab" aria-controls="tab-3" 
                            aria-selected="false">All Policy Notes</button>
                        </li>
                        
                        
                        
                    </ul>
                </div>

                <div class="card-styles">
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <!-- Start Policies Tab -->
                        <div class="tab-pane active" id="tab-pane__tab-1" role="tabpanel" aria-labelledby="tab-1">
                            <div class="table-style table-style-1 table-layout-fixed">
                                <div class="table-responsive more-data-table-2">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th scope="col" class="w80">#</th>
                                                <th scope="col" class="w120">Actions</th>
                                                <th scope="col">Policy Status
                                                </th>
                                                <th scope="col">Policy No.</th>
                                                <th scope="col">Plan Name</th>
                                                <th scope="col">First Name</th>
                                                <th scope="col">Last Name</th>
                                                <th scope="col">Email</th>
                                                <th scope="col">Phone</th>
                                                <th scope="col">Zip Code</th>
                                                <th scope="col">Address </th>
                                                <th scope="col">State</th>
                                                <th scope="col">Amount</th>
                                                <th scope="col">Order On</th>
                                                <th scope="col">Effective
                                                    From</th>
                                                <th scope="col">Expiry With
                                                    Bonus</th>
                                                <th scope="col">Policy Term</th>
                                                <th scope="col">SCF</th>
                                                <th>Source</th>
                                                <th>Sales Representative</th>
                                                <th>Cancellation Form</th>
                                                <th scope="col">Created On</th>
                                                <th scope="col">Updated On</th>
                                            </tr>
                                        </thead>
                                        <tbody *ngIf="policySaleList?.length>0">
                                            <tr *ngFor="let item of policySaleList; let i=index" [ngClass]="item.is_anamaly==1 ? 'anamaly': ''">
                                                <td>{{i+1}}</td>
                                                <td>
                                                    <div class="btn-group" dropdown container="body">
                                                        <button id="button-basic" dropdownToggle type="button"
                                                            class="btn btn-action dropdown-toggle"
                                                            aria-controls="dropdown-basic">Actions<span
                                                                class="caret"></span></button>
                                                        <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu"
                                                            role="menu" aria-labelledby="button-basic">
                                                            <li><a (click)="openClaimViewModal(claimViewEleRef,item)" 
                                                                class="dropdown-item" type="button">View Claim</a>
                                                            </li>
                                                            <li><a (click)="openPaymentsViewModal(paymenViewEleRef,item)"
                                                                class="dropdown-item" type="button">Payments</a>
                                                            </li>
                                                            <li><a type="button" data-bs-toggle="tooltip"
                                                                data-bs-placement="top" title=""
                                                                data-bs-original-title="Anamaly"
                                                                class="dropdown-item"
                                                                (click)="markAnamaly(item)">{{item.is_anamaly?'Unmark':'Mark'}} as Anamaly
                                                            </a>
                                                        </li>
                                                        </ul>
                                                    </div>
                                                </td>
                                                <td>
                                                    <!-- <span class="badge radius:tiny size:tiny padding:tiny" [attr.data-status]=item?.policy_status_details>{{item?.policy_status_details}}</span> -->
                                                    <span class="badge radius:tiny size:tiny padding:tiny" [ngStyle]="{'background-color':item?.policy_status_details?.status_color }">{{item?.policy_status_details?.status_name}}</span>
                                                </td>
                                                <td>
                                                    <span (click)="navigateToCustomerDetails(item?.customer_id)"
                                                        class="py-1 c--mdSky" role="button">{{item?.policy_number}}
                                                    </span>
                                                </td>
                                                <td>{{item?.plan_details?.plan_name}}</td>
                                                <td>{{item?.first_name}}</td>
                                                <td>{{item?.last_name}}</td>
                                                <td>{{item?.email}}</td>
                                                <td>{{item?.mobile | phoneUsFormat}}</td>
                                                <td>{{item?.billing_zip}}</td>
                                                <td>{{item?.billing_address1}}</td>
                                                <td>{{item?.billing_state}}</td>
                                                <td>{{item?.net_amount| currency:'USD'}}</td>
                                                <td>{{item?.order_date|date:'MM-dd-YYYY'}}</td>
                                                <td>{{item?.policy_start_date|date:'MM-dd-YYYY'}}</td>
                                                <td>{{item?.expiry_with_bonus|date:'MM-dd-YYYY'}}</td>
                                                <td>{{item?.policy_term}}</td>
                                                <td>{{item?.pcf | currency:'USD'}}</td>
                                                <td>{{item?.source==0?"Self Customer":'Backend Team'}}</td>
                                                <td>N/A</td>
                                                <td>N/A</td>
                                                <td>{{item?.created_at|date:'MM-dd-YYYY'}}</td>
                                                <td>{{item?.updated_at|date:'MM-dd-YYYY'}}</td>
                                            </tr>
                                        </tbody>
                                        <tbody *ngIf="policySaleList?.length==0">
                                            <tr>
                                                <td colspan="12" class="text-center">No data found</td>
                                            </tr>
                                        </tbody> 
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- End Policies Tab -->

                        

                        <!-- Start policy note tab -->
                        <div class="tab-pane" id="tab-pane__tab-3" role="tabpanel" aria-labelledby="tab-3">
                            <app-poliy-note-table [tableHeaderData]="policyNotesTableHeaders" [tableBodyData]="policyNotesTableData"></app-poliy-note-table>
                        </div>
                        <!-- End policy note tab -->
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<ng-template #claimViewEleRef>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Claim Details</h4>
        <button type="button" class="btn-close close pull-right" aria-label="Close"
            (click)="closeClaimViewModal()">
            <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
    </div>
    
    <div class="modal-body">    
            <app-claim-table [headers]="tableHeaders" [data]="tableData"></app-claim-table>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-secondary" (click)="closeClaimViewModal()">Close</button>
    </div>
</ng-template>

<ng-template #paymenViewEleRef>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Payment Details</h4>
        <button type="button" class="btn-close close pull-right" aria-label="Close"
            (click)="closePaymentViewModal()">
            <span aria-hidden="true" class="visually-hidden">&times;</span>
        </button>
    </div>
    
    <div class="modal-body">    
            <app-claim-table [headers]="tableHeaders" [data]="tableData"></app-claim-table>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-secondary" (click)="closePaymentViewModal()">Close</button>
    </div>
</ng-template>
