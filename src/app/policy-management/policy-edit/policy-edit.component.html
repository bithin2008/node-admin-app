<div class="row mb-4" *ngIf="policyDetails">
    <div class="col card_wrapper">
        <div class="">
  
            <div class="card-body">
                <!-- <app-post></app-post> -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card-1" id="table"> <!-- PAGE HEADER -->
                            <div class="card__head">
                                <div class="card-heading">
                                    <p class="h4 c--drkgry">Edit Policy</p>
                                </div>
                            </div>
                            <div class="card__body pt-0 px-0">
                                <form [formGroup]="editPolicyForm" class="form-style flow-rootX app-form unauth-form-max-w d-flex align-items-start" (ngSubmit)="onSubmit()">
                                    <div class="col">
                                        <div class="card__body">
                                            <div class="card__body__container">
                                            <div>
                                                <div class="row">
                                                    <h4 class="h4 c--drkgry mb-2 pl-1 d-flex align-items-center">
                                                        <!-- <i class="pi pi-home x2"></i>&nbsp; -->
                                                        <span>Property Address</span></h4>
                                                
                                                    <div class="col-lg-4">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" formControlName="first_name"
                                                            [ngClass]="{ 'is-invalid': submitted && f['first_name'].errors }"appCapitalize>
                                                            <label class="form-label">First Name <span class="c--error">*</span></label>
                                                            <app-validation-error  [control]="f['first_name']"></app-validation-error>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" formControlName="last_name"
                                                            [ngClass]="{ 'is-invalid': submitted && f['last_name'].errors }"appCapitalize>
                                                            <label class="form-label">Last Name <span class="c--error">*</span></label>
                                                            <app-validation-error [control]="f['last_name']"></app-validation-error>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-lg-4">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" formControlName="email" 
                                                                [ngClass]="{ 'is-invalid': submitted && f['email'].errors }">
                                                            <label class="form-label">Email Address <span class="c--error">*</span></label>
                                                            <app-validation-error [control]="f['email']"></app-validation-error>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" formControlName="mobile" [appInputLimit]="10" [appInputType]="'number'"
                                                            [ngClass]="{ 'is-invalid': submitted && f['mobile'].errors }" (input)="changePhoneFormat('mobile')">
                                                            <label class="form-label">Mobile <span class="c--error">*</span></label>
                                                            <app-validation-error [control]="f['mobile']"></app-validation-error>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="form-floating  polytextarea">
                                                            <input type="text" class="form-control" formControlName="billing_address1" id="addressBar"
                                                                [ngClass]="{ 'is-invalid': submitted && f['billing_address1'].errors }">
                                                            <label class="form-label">Address <span class="c--error">*</span></label>
                                                            <app-validation-error [control]="f['billing_address1']"></app-validation-error>
                                                        </div>
                                                    </div>
                                        
                                                    <div class="col-lg-4">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" formControlName="billing_zip"
                                                            [ngClass]="{ 'is-invalid': submitted && f['billing_zip'].errors }"  maxlength="5"(input)="changeZip('billing_zip')">
                                                            <label class="form-label">ZIP <span class="c--error">*</span></label>
                                                            <app-validation-error [control]="f['billing_zip']"></app-validation-error>
                                                            <div class="app-validation-error">
                                                                <div class="p-0 alert alert-danger" *ngIf="validZipBillingMessage">
                                                                    <i aria-hidden="true" class="pi pi-exclamation-circle me-2"></i>
                                                                    <span>{{validZipBillingMessage}}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" formControlName="billing_city"readonly
                                                            [ngClass]="{ 'is-invalid': submitted && f['billing_city'].errors }">
                                                            <label class="form-label">City <span class="c--error">*</span></label>
                                                            <app-validation-error [control]="f['billing_city']"></app-validation-error>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" formControlName="billing_state"readonly
                                                            [ngClass]="{ 'is-invalid': submitted && f['billing_state'].errors }">
                                                            <label class="form-label">State <span class="c--error">*</span></label>
                                                            <app-validation-error [control]="f['billing_state']"></app-validation-error>
                                                        </div>
                                                    </div>
                                                        
                                                    
                                                </div>
                                            </div>
                                            </div>
                                        </div>    
                                        <div class="card__body">
                                            <div class="card__body__container">
                                            <div>
                                                <h4 class="h4 c--drkgry mb-2 d-flex align-items-center">
                                                    <!-- <i class="pi pi-home"></i>&nbsp; -->
                                                    <span>Plan Information</span>
                                                </h4>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <div class="row">
                                                            <div class="col-lg-12">
                                                                <div class="row">
                                                                    <div class="col-lg-6">
                                                                        <div class="form-floating">
                                                                            <select class="form-control form-select" (ngModelChange)="onChangePlan()" formControlName="plan_id"   [ngClass]="{ 'is-invalid': submitted && f['plan_id'].errors }">
                                                                                <option value=""> Select</option>
                                                                                <option [value]="item?.plan_id" *ngFor="let item of planList; let i=index">{{item?.plan_name}}</option>
                                                                            </select>
                                                                            <label for="" class="form-label">Select Plan <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['plan_id']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6  ">
                                                                        <div class="form-floating">
                                                                            <select class="form-control form-select" (ngModelChange)="getPlansTermList()" formControlName="property_type_id"[ngClass]="{ 'is-invalid': submitted && f['property_type_id'].errors }">
                                                                                <option value=""> Select</option>
                                                                                <option value="{{item?.property_type_id}}" *ngFor="let item of propertyTypeList let i=index">{{item?.property_type}}</option>
                                                                            </select>
                                                                            <label class="form-label">Property Type <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['property_type_id']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6  ">
                                                                        <div class="form-floating">
                                                                            <select class="form-control form-select" formControlName="property_size_id"  (change)="onChangePlanTermOrPropertySize()" [ngClass]="{ 'is-invalid': submitted && f['property_size_id'].errors }">
                                                                                <option value="">Select</option>
                                                                                <option value="0">Under 5,000 sq. ft</option>
                                                                                <option value="1">Over 5,000 sq. ft</option>
                                                                            </select>
                                                                            <label for="" class="form-label">Property Size <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['property_size_id']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6">                                                                    
                                                                        <div class="form-floating">
                                                                            <select class="form-control form-select" (change)="onChangePlanTermOrPropertySize()" formControlName="plan_terms_id"[ngClass]="{ 'is-invalid': submitted && f['plan_terms_id'].errors }">
                                                                                <option [value]=""> Select</option>
                                                                                <option [value]="item?.plan_terms_id" *ngFor="let item of planTermList let i=index">{{item?.plan_term}}</option>
                                                                            </select>
                                                                            <label class="form-label">Plan Term <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['plan_terms_id']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                    <!-- [attr.disabled]="f['property_type_id'].value === '' || f['plan_id'].value === ''"  -->
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-12">
                                                                <div class="row">
                                                                    
                                                                <!--  <div class="col-lg-6  ">
                                                                        <div class="form-floating">
                                                                            <input type="text" class="form-control" formControlName="pcf"
                                                                            [ngClass]="{ 'is-invalid': submitted && f['pcf'].errors }">
                                                                            <label class="form-label">Service Claim Fee (SCF)($) <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['pcf']"></app-validation-error>
                                                                        </div>
                                                                    </div> -->
                                                                    <div class="col-lg-6">
                                                                        <div class="form-floating">
                                                                            <select class="form-control form-select"  formControlName="pcf"
                                                                                [ngClass]="{ 'is-invalid': submitted && f['pcf'].errors }">
                                                                                <option value="">Select</option>
                                                                                <ng-container *ngFor="let item of serviceCallFeesList">
                                                                                    <option [ngValue]="item?.scf_value" >{{item?.scf_value}}</option>
                                                                                </ng-container>
                                                                            </select>
                                                                            <label for="" class="form-label">Service Claim Fee (SCF)($) <span class="c--error">*</span></label>
                                                                            <app-validation-error  [control]="f['pcf']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6  ">
                                                                        <div class="form-floating">
                                                                            <select class="form-control form-select" (ngModelChange)="onChangeHoldingPeriod()" formControlName="holding_period"   [ngClass]="{ 'is-invalid': submitted && f['holding_period'].errors }">
                                                                                <ng-container *ngFor="let item of holdingPeriod">
                                                                                    <option value="{{item?.holding_period}}" >{{item?.holding_period}}</option>
                                                                                </ng-container>
                                                                            </select>
                                                                            <label for="" class="form-label">Holding Period <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['holding_period']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-12">
                                                                <div class="row">
                                                                    <div class="col-lg-6 mb-2">
                                                                        <div class="mb-0 mr-0 datepickform static-dt {{f['policy_start_date'].value?'has-static-dt':''}}">
                                                                            <label for="static-dt-lbl" class="">Policy Start Date <span class="c--error">*</span></label>
                                                                            <p>{{ f['policy_start_date'].value | date: 'MM-dd-yyyy' }}</p>
                                                                            <app-validation-error [control]="f['policy_start_date']"></app-validation-error>
                                                                        </div> 
                                                                    </div>
                                                                    <div class="col-lg-6 mb-2">
                                                                        <div class="mb-0 mr-0 static-dt {{f['policy_end_date'].value?'has-static-dt':''}}">
                                                                            <label for="static-dt-lbl" class="">Policy Expiry Date <span class="c--error">*</span></label>
                                                                            <p>{{ f['policy_end_date'].value | date: 'MM-dd-yyyy' }}</p>
                                                                        </div>
                                                                        <app-validation-error [control]="f['policy_end_date']"></app-validation-error>
                                                                    </div>
                                                                    <div class="col-lg-6">
                                                                        <div class="form-floating">
                                                                            <select class="form-control form-select"  [ngClass]="{ 'is-invalid': submitted && f['bonus_month'].errors }" formControlName="bonus_month" (ngModelChange)="onChangeBonusMonth()" >
                                                                                <option [value]='0'>0</option>
                                                                                <option *ngFor="let item of bonusMonths;" [value]='item'>{{item}}</option>
                                                                            </select>
                                                                            <label for="" class="form-label">Bonus Month <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['bonus_month']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6">
                                                                        <div class="mb-0 mr-0 static-dt {{f['expiry_with_bonus'].value?'has-static-dt':''}}">
                                                                            <label for="static-dt-lbl" class="">Expiry With Bonus Date<span class="c--error">*</span></label>
                                                                            <p *ngIf="f['expiry_with_bonus']?.value">{{ f['expiry_with_bonus']?.value | date: 'MM-dd-yyyy' }}</p>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6">
                                                                        <div class="form-floating">
                                                                            <input type="text" class="form-control" formControlName="policy_amount" (input)="calculateSubtotalPrice()"
                                                                            [ngClass]="{ 'is-invalid': submitted && f['policy_amount'].errors }">
                                                                            <label class="form-label">Policy Amount($) <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['policy_amount']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6  ">
                                                                        <div class="form-floating">
                                                                            <input type="text" class="form-control" formControlName="addon_coverage_amount" (input)="calculateSubtotalPrice()"
                                                                            [ngClass]="{ 'is-invalid': submitted && f['addon_coverage_amount'].errors }">
                                                                            <label class="form-label">Add-On Coverage Amount($)  <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['addon_coverage_amount']"></app-validation-error>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6">
                                                                        <div class="form-radio-group radio-bx-check {{f['net_amount'].value?'':'disable_sec'}}">
                                                                            <label class="form__label-radio"  for="ny_tax">
                                                                                <input type="radio" name="tax_type" id="ny_tax"(ngModelChange)="appliclableTax()" value="1" formControlName="tax_type"  class="form__radio-input" [checked]="f['tax_type'].value==1">
                                                                                <span class="form__radio-button"></span>
                                                                                <p> Apply NY Tax</p>
                                                                            </label>
                                                                            <label class="form__label-radio"   for="state_tax">
                                                                                <input type="radio" name="tax_type" id="state_tax"(ngModelChange)="appliclableTax()"[checked]="f['tax_type'].value==2" value="2" class="form__radio-input" formControlName="tax_type">
                                                                                <span class="form__radio-button"></span>
                                                                                <p>Apply State Tax</p>
                                                                            </label>
                                                                            <label class="form__label-radio"  for="wave_off_tax"> 
                                                                                <input type="radio" name="tax_type" id="wave_off_tax" (ngModelChange)="appliclableTax()" [checked]="f['tax_type'].value==3"value="3"formControlName="tax_type" class="form__radio-input" >
                                                                                <span class="form__radio-button"></span>
                                                                                <p>Wave-off Tax</p>
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-lg-6  ">
                                                                        <div class="form-floating">
                                                                            <input type="text" class="form-control disabled-prompt" formControlName="tax_percentage" (input)="taxAmountCalculate()" onkeydown="return false"
                                                                            [ngClass]="{ 'is-invalid': submitted && f['tax_percentage'].errors }" 
                                                                            appPositiveNumber   [decimal]="true"  [maxAllowed]="99">
                                                                            <label class="form-label">Tax Percentage(%) <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['tax_percentage']"></app-validation-error>
                                                                        </div> 
                                                                    </div>
                                                                    
                                                                
                                                                </div>
                                                            </div>
                                                        </div>
                                                    
                                                    </div>
                                                    
                                                </div>
                                            </div>  
                                            </div>  
                                        </div>    
                                    <!--   <div class="card__body mt-1" >
                                            <div class="card__body__container">
                                            <div>
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <h4 class="h4 c--drkgry">Choose Add-On Coverage Items</h4>
                                                        <div class="row">
                                                            <div class="col-6 addOn_mb" *ngFor="let item of addOnProductsList;">
                                                                <div class="form-checkbox inline-style">
                                                                    <label>
                                                                        <input type="checkbox" name="selectedAddOnItems" class="selectedAddOnItems" value="{{item?.product_id}}" (change)="onChangeAddOnItem($event,item)">
                                                                        <span class="checkmark"></span>
                                                                        <p>{{item?.product_name}}</p>
                                                                    </label>
                                                                </div>
                                                                <div class="addOn_pric">
                                                                    <p *ngIf="f['plan_terms_month'].value>1">{{item?.yearly_price |
                                                                        currency:'USD'}}</p>
                                                                    <p *ngIf="f['plan_terms_month'].value==1">{{item?.monthly_price |
                                                                        currency:'USD'}}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        </div>     -->    
                                        <div class="card__body">
                                            <div class="card__body__container">
                                                <div>
                                                    <div class="row">
                                                        <div class="col-lg-12">
                                                            <h4 class="h4 c--drkgry">Choose Add-On Coverage Items</h4>
                                                            <div class="row addOn_rw">
                                                                <div class="col-lg-6 addOn_mb"
                                                                    *ngFor="let item of   addOnProductsList;">
                                                                    <div class="addonList">
                                                                        <div class="form-checkbox inline-style">
                                                                            <label>
                                                                                <input type="checkbox"
                                                                                    name="selectedAddOnItems"
                                                                                    class="selectedAddOnItems"
                                                                                    value="{{item?.product_id}}"
                                                                                    (change)="onChangeAddOnItem($event,item)">
                                                                                <span class="checkmark"></span>
                                                                                <p>{{item?.product_name}}</p>
                                                                            </label>
                                                                        </div>
                                                                        <div class="addOn_pric">
                                                                            <p *ngIf="f['plan_terms_month'].value>1">{{item?.update_yearly_price |
                                                                                currency:'USD'}}</p>
                                                                            <p *ngIf="f['plan_terms_month'].value==1">{{item?.monthly_price |
                                                                                currency:'USD'}}</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>      
                                                
                                            
                                        <div class="card__body mt-1" *ngIf="showPayment">
                                            <div class="card__body__container">
                                                <div >
                                                <h4   class="h3 c--drkgry mb-2 d-flex align-items-center">
                                                    <!-- <i class="pi pi-credit-card x2"></i>  -->
                                                    <span>Payment Method</span> </h4>

                                                <div class="row align-items-end">
                                                    <div class="col-lg-12 paymnt-box mb-0">
                                                        <!-- <ul>
                                                        <li>
                                                            <button class="cc-btn active" (click)="changePaymentTab(1)" id="pills-card-tab" data-bs-toggle="pill" data-bs-target="#pills-card" type="button" role="tab" aria-controls="pills-card" aria-selected="true">
                                                                <div class="form-radio-group">
                                                                    <label class="form__label-radio"
                                                                        for="creditCard">
                                                                        <input type="radio" name="radio2"
                                                                            id="creditCard" value="radio4"
                                                                            class="form__radio-input" checked>
                                                                        <span class="form__radio-button"></span>
                                                                        <p>Credit card</p>
                                                                    </label>
                                                                </div>
                                                            </button>
                                                        </li>
                                                        <li>
                                                            <button class="bank-btn ml-1" id="pills-bank-tab" (click)="changePaymentTab(2)">
                                                                <div class="form-radio-group">
                                                                    <input type="radio" name="radio2"
                                                                        id="bankAccount" value="radio4"
                                                                        class="form__radio-input">

                                                                    <label class="form__label-radio"
                                                                        for="bankAccount">
                                                                        <span class="form__radio-button"></span>
                                                                        <p>Bank account</p>
                                                                    </label>
                                                                </div>
                                                            </button>
                                                        </li>
                                                        <li *ngIf="showEscrowOrDoNotCharge">
                                                            <button class="escrow-btn" id="pills-escrow-tab"
                                                                (click)="changePaymentTab(3)"> 
                                                                <div class="form-radio-group">
                                                                    <input type="radio" name="radio2" id="escrow"
                                                                        value="radio4" class="form__radio-input">
                                                                    <label class="form__label-radio" for="escrow">
                                                                        <span class="form__radio-button"></span>
                                                                        <p>Escrow</p>
                                                                    </label>
                                                                </div>
                                                            </button>
                                                        </li>
                                                        <li *ngIf="showEscrowOrDoNotCharge">
                                                            <button class="not-charge-btn" id="pills-not-charge-tab"
                                                                (click)="changePaymentTab(4)">
                                                                <div class="form-radio-group">
                                                                    <input type="radio" name="radio2" id="notChang"
                                                                        value="radio4" class="form__radio-input">
                                                                    <label class="form__label-radio" for="notChang">
                                                                        <span class="form__radio-button"></span>
                                                                        <p>Do not Charge</p>
                                                                    </label>
                                                                </div>
                                                            </button>
                                                        </li>
                                                        
                                                        </ul> -->
                                                        <ul>
                                                            <li class="{{f['payment_type'].value==1?'active':''}}">
                                                                <button class="cc-btn" type="button" (click)="changePaymentTab(1)">
                                                                    <div class="form-radio-group">
                                                                        <label class="form__label-radio"
                                                                            for="creditCard">
                                                                            <input type="radio"[checked]="f['payment_type'].value==1" name="radio2"
                                                                                id="creditCard" value="radio4"
                                                                                class="form__radio-input" checked>
                                                                            <span class="form__radio-button"></span>
                                                                            <p>Credit Card</p>
                                                                        </label>
                                                                    </div>
                                                                </button>
                                                            </li>
                                                            <!-- <li class="{{f['payment_type'].value==2?'active':''}}">
                                                                <button class="bank-btn" type="button"  (click)="changePaymentTab(2)">
                                                                    <div class="form-radio-group">
                                                                        <input type="radio" [checked]="f['payment_type'].value==2" name="radio2"
                                                                            id="bankAccount" value="radio4"
                                                                            class="form__radio-input">

                                                                        <label class="form__label-radio"
                                                                            for="bankAccount">
                                                                            <span class="form__radio-button"></span>
                                                                            <p>Bank Account</p>
                                                                        </label>
                                                                    </div>
                                                                </button>
                                                            </li> -->
                                                            <li class="{{f['payment_type'].value==3?'active':''}}"
                                                                *ngIf="showEscrowOrDoNotCharge">
                                                                <button class="escrow-btn" type="button"(click)="changePaymentTab(3)">
                                                                    <div class="form-radio-group">
                                                                        <input type="radio" [checked]="f['payment_type'].value==3" name="radio2" id="escrow"
                                                                            value="radio4" class="form__radio-input">
                                                                        <label class="form__label-radio" for="escrow">
                                                                            <span class="form__radio-button"></span>
                                                                            <p>Escrow</p>
                                                                        </label>
                                                                    </div>
                                                                </button>
                                                            </li>
                                                            <li class="{{f['payment_type'].value==4?'active':''}}"
                                                                *ngIf="showEscrowOrDoNotCharge">
                                                                <button type="button" class="not-charge-btn" (click)="changePaymentTab(4)">
                                                                    <div class="form-radio-group">
                                                                        <input type="radio" name="radio2" id="notChang"
                                                                            value="radio4" [checked]="f['payment_type'].value==4" class="form__radio-input">
                                                                        <label class="form__label-radio" for="notChang">
                                                                            <span class="form__radio-button"></span>
                                                                            <p>Do Not Charge</p>
                                                                        </label>
                                                                    </div>
                                                                </button>
                                                            </li>
                                                        </ul>
                                
                                                        
                                                            <div class="tab-content"[ngSwitch]="f['payment_type'].value">
                                                                <div   *ngSwitchCase="'1'">
                                                                    <div class="row">
                                                                        <div class="col-lg-8" *ngIf="policyDetails.customer_details?.card_list?.length>0">
                                                                            <div class="form-radio inline-style mb-1">
                                                                                <label>
                                                                                    <input type="radio" name="newOrSavedCard" value="1" formControlName="newOrSavedCard"  (ngModelChange)="onChangeNewOrSavedCard()">
                                                                                    <span class="checkmark"></span>
                                                                                    <p>New Card</p>
                                                                                </label>
                                                                                <label>
                                                                                    <input type="radio" name="newOrSavedCard" value="2"  formControlName="newOrSavedCard"  (ngModelChange)="onChangeNewOrSavedCard()">
                                                                                    <span class="checkmark"></span>
                                                                                    <p>Saved Card</p>
                                                                                </label>
                                                                                
                                                                            </div>  
                                                                        </div>
                                                                    </div>
                                                                    <div class="row" >
                                                                        <ng-container *ngIf="!f['selectedCardId'].value">
                                                                        <div class="col-lg-6">
                                                                            <div class="form-floating">
                                                                                <input type="text"   class="form-control" appCapitalize  [readOnly]="f['selectedCardId'].value"
                                                                                formControlName="cardHolderName"  [ngClass]="{ 'is-invalid': submitted && f['cardHolderName'].errors }">
                                                                                <label class="form-label">Card Holder Name <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['cardHolderName']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-6">
                                                                            <div class="input-group">
                                                                                <div class="form-floating mb-0">
                                                                                    <input type="text"   [readOnly]="f['selectedCardId'].value" [minlength]="14" [maxlength]="21" appCardFormatter class="form-control"  formControlName="cardNumber"  [ngClass]="{ 'is-invalid': submitted && f['cardNumber'].errors }">
                                                                                    <label class="form-label">Card Number <span class="c--error">*</span></label>
                                                                                </div>
                                                                                <div class="input-group-prepend">
                                                                                    <div class="card-svg-icon">
                                                                                        <img id="cardImage" width="40px" src="assets/img/allCardIcon/credit-card.svg" alt="Card Image" title="Card Image">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <app-validation-error  [control]="f['cardNumber']"></app-validation-error>
                                                                            
                                                                        </div>
                                                                        <div class="col-lg-4">
                                                                            <div class="form-floating mr-0 plcexp">
                                                                                <input type="text" class="form-control" [readOnly]="f['selectedCardId'].value"
                                                                                formControlName="cardExpiryDate" appCardExpiryDate [ngClass]="{ 'is-invalid': submitted && f['cardExpiryDate'].errors }">
                                                                                <label class="form-label">Expiry Date <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['cardExpiryDate']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-3">
                                                                            <div class="form-floating">
                                                                                <input type="text"   class="form-control" [minlength]="3" [maxlength]="4"  [appInputLimit]="4" 
                                                                                formControlName="cvv"  [ngClass]="{ 'is-invalid': submitted && f['cvv'].errors }">
                                                                                <label class="form-label">CVV <span class="c--error">*</span></label>
                                                                            <app-validation-error [control]="f['cvv']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                        </ng-container>
                                                                        <div class="col-lg-6"  *ngIf="f['newOrSavedCard'].value==2">
                                                                            <div class="input-group">
                                                                                <div class="form-floating mb-0">
                                                                                    <select class="form-control form-select" formControlName="selectedCardId" (ngModelChange)="onChangecard()"  >
                                                                                        <option *ngFor="let item of policyDetails.customer_details?.card_list" [ngValue]="item?.customer_card_id">{{item?.card_last_4_digit}}</option>
                                                                                    </select>
                                                                                    <label for="" class="form-label">Select Card Number<span class="c--error">*</span></label>
                                                                                    <app-validation-error  [control]="f['cardNumber']"></app-validation-error>
                                                                                </div>
                                                                                <div class="input-group-prepend">
                                                                                    <div class="card-svg-icon">
                                                                                        <img id="cardImageSelected" width="40px" [src]="imgSrc" alt="Card Image" title="Card Image">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            
                                                                            <!-- <div class="d-flex">
                                                                                    
                                                                                <div class="form-floating">
                                                                                    <select class="form-control form-select" formControlName="selectedCardId" (ngModelChange)="onChangecard()"  >
                                                                                        <option *ngFor="let item of policyDetails.customer_details?.card_list" [ngValue]="item?.customer_card_id">{{item?.card_last_4_digit}}</option>
                                                                                    </select>
                                                                                    <label for="" class="form-label">Select Card Number<span class="c--error">*</span></label>
                                                                                </div>
                                                                                <div class="card-svg-icon">
                                                                                    <img id="cardImageSelected" alt="Card Image" width="40px" [src]="imgSrc">
                                                                                </div>
                                                                            </div> -->
                                                                        </div>
                                                                        
                                                                        <div class="col-lg-5" style="pointer-events: none;opacity: 0.5;">
                                                                            <div class="form-floating datepickform mr-0">
                                                                                <input type="text"  class="form-control"
                                                                                    formControlName="paymentDate" bsDatepicker 
                                                                                    [bsConfig]="{ adaptivePosition: true, dateInputFormat: 'MM-DD-YYYY',showWeekNumbers: false  }" [minDate]="today" (bsValueChange)="changePaymentDate($event)" onkeydown="return false"
                                                                                    autocomplete="off" [ngClass]="{ 'is-invalid': submitted && f['paymentDate'].errors }">
                                                                                <label class="form-label">Payment Date <span class="c--error">*</span></label>
                                                                                <app-validation-error [control]="f['paymentDate']"></app-validation-error>
                                                                            </div>
                                                                            
                                                                        </div>
                                                                        
                                                                    </div>
                                                                </div>
                                                                <div *ngSwitchCase="'2'" >
                                                                    <div class="row">
                                                                        <div class="col-lg-12">
                                                                            <div class="form-floating">
                                                                                <input type="text" class="form-control" formControlName="bankAccountHolderName"
                                                                                    [ngClass]="{ 'is-invalid': submitted && f['bankAccountHolderName'].errors }" appCapitalize>
                                                                                <label class="form-label">Account Holder Name <span class="c--error">*</span></label>
                                                                                <app-validation-error [control]="f['bankAccountHolderName']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-4">
                                                                            <div class="form-floating">
                                                                                <input type="text" class="form-control" formControlName="bankAccountNumber"
                                                                                    [ngClass]="{ 'is-invalid': submitted && f['bankAccountNumber'].errors }">
                                                                                <label class="form-label">Account Number <span class="c--error">*</span></label>
                                                                                <app-validation-error [control]="f['bankAccountNumber']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-4">
                                                                            <div class="form-floating">
                                                                                <input type="text" class="form-control" formControlName="routingNumber"
                                                                                    [ngClass]="{ 'is-invalid': submitted && f['routingNumber'].errors }">
                                                                                <label class="form-label"> Routing number <span class="c--error">*</span></label>
                                                                                <app-validation-error [control]="f['routingNumber']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-4">
                                                                            <div class="form-floating datepickform mr-0">
                                                                                <input type="text"  class="form-control"
                                                                                    formControlName="paymentDate" bsDatepicker
                                                                                    [bsConfig]="{ adaptivePosition: true, dateInputFormat: 'MM-DD-YYYY',showWeekNumbers: false  }" [minDate]="today" (bsValueChange)="changePaymentDate($event)" onkeydown="return false"
                                                                                    autocomplete="off" [ngClass]="{ 'is-invalid': submitted && f['paymentDate'].errors }">
                                                                                <label class="form-label">Payment Date <span class="c--error">*</span></label>
                                                                                <app-validation-error [control]="f['paymentDate']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div  *ngSwitchCase="'3'">
                                                                <!--  <div class="row">
                                                                        <div class="col-lg-4">
                                                                            <div class="form-floating">
                                                                                <input type="text" class="form-control"
                                                                                    formControlName="cheque_no"
                                                                                    [ngClass]="{ 'is-invalid': submitted && f['cheque_no'].errors }">
                                                                                <label class="form-label"> Check No. </label>
                                                                                <app-validation-error [control]="f['cheque_no']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-4">
                                                                            <div class="form-floating datepickform mr-0">
                                                                                <input type="text" class="form-control"
                                                                                    formControlName="paymentDate"
                                                                                    bsDatepicker
                                                                                    [bsConfig]="{ adaptivePosition: true, dateInputFormat: 'MM-DD-YYYY',showWeekNumbers: false  }"
                                                                                    [minDate]="today"
                                                                                    (bsValueChange)="changePaymentDate($event)"
                                                                                    onkeydown="return false"
                                                                                    autocomplete="off"
                                                                                    [ngClass]="{ 'is-invalid': submitted && f['paymentDate'].errors }">
                                                                                <label class="form-label">Payment Date </label>
                                                                                <app-validation-error
                                                                                    [control]="f['paymentDate']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                    </div> -->
                                                                </div>
                                                                <div  *ngSwitchCase="'4'">
                                                                    <!--  <div class="row">  
                                                                        <div class="col-lg-6">
                                                                            <div class="form-floating">
                                                                                <input type="text" class="form-control"
                                                                                    formControlName="paymentDate"
                                                                                    bsDatepicker
                                                                                    [bsConfig]="{ adaptivePosition: true, dateInputFormat: 'MM-DD-YYYY',showWeekNumbers: false  }"
                                                                                    [minDate]="today"
                                                                                    (bsValueChange)="changePaymentDate($event)"
                                                                                    onkeydown="return false"
                                                                                    autocomplete="off"
                                                                                    [ngClass]="{ 'is-invalid': submitted && f['paymentDate'].errors }">
                                                                                <label class="form-label">Payment Date </label>
                                                                                <app-validation-error
                                                                                    [control]="f['paymentDate']"></app-validation-error>
                                                                            </div>
                                                                        </div>
                                                                    </div> -->
                                                                </div>
                                                            </div>
                                                        
                                                    </div>
                                                
                                                </div>
                                                </div>
                                            </div>
                                        </div>     
                                        <div class="card__body">
                                            <div class="card__body__container">
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <div class="form-floating polytextarea mb-0">
                                                            <textarea type="text" rows="3" cols="3" [ngClass]="{ 'is-invalid': submitted && f['policy_note'].errors }" formControlName="policy_note" class="form-control" formControlName="policy_note"></textarea>
                                                            <label class="form-label">Policy note </label>    
                                                            <app-validation-error [control]="f['policy_note']"></app-validation-error>
            
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </div>   
                                        <div class="text-right submit_py_con ml-auto pr-1">
                                            <button type="submit" class="btn btn-primary btn-xl text-uppercase final-crect-btn"[disabled]="loading">
                                                <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>Update Policy
                                            </button>
                                        </div>   
                                        

                                    </div>
                                    <div class="col-auto policy-col">
                                        <div class="policy_ammt_wrap">
                                            <div class="cal_ammt">
                                                <table class="table">
                                                    <tbody>
                                                        <tr>
                                                            <td>Policy Amount</td>
                                                            <td class="text-right fw--sb">
                                                                {{ (f['policy_amount'].value ? (f['policy_amount'].value | currency:'USD') : 0| currency:'USD') }}

                                                                </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Add-On Amount</td>
                                                            <td class="text-right fw--sb">
                                                                {{ (f['addon_coverage_amount'].value ? (f['addon_coverage_amount'].value | currency:'USD') : 0| currency:'USD') }}

                                                                </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Subtotal (Pre-Tax)</td>
                                                            <td class="text-right">
                                                                <!-- <input type="text" formControlName="sub_total_amount"  > -->
                                                                {{f['sub_total_amount'].value  | currency:'USD'}}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Miscellaneous Charges</td>
                                                            <td class="text-right fw--sb">
                                                                {{ (f['miscellaneous_charges'].value ? (f['miscellaneous_charges'].value | currency:'USD') : 0| currency:'USD') }}

                                                                </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Discount</td>
                                                            <td class="text-right fw--sb">
                                                                {{ (f['discount_amount'].value ? (f['discount_amount'].value | currency:'USD') : 0| currency:'USD') }}
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Tax Amount ({{f['tax_percentage'].value?f['tax_percentage'].value:0}}%)</td>
                                                            <td class="text-right">{{f['tax_amount'].value  | currency:'USD'}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <table class="total_amt_tabl">
                                                <tbody>
                                                    <tr>
                                                        <td><strong>Total:</strong></td>
                                                        <td class="text-right"><strong>{{f['net_amount'].value  | currency:'USD'}}</strong></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="needpay">
                                            <table class="table">
                                                <tbody>
                                                    <tr *ngIf="f['net_amount'].value>policyDetails.net_amount">
                                                        <td><p>Need To Pay </p></td>
                                                        <td class="text-right"><strong>{{f['updatePaymentAmount'].value  | currency:'USD' }}</strong></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    <!--  <div class="commission">
                                            <table class="table">
                                                <tbody>
                                                    <tr>
                                                        <td><p>Sales Commission</p></td>
                                                        <td class="text-right">
                                                            <span *ngIf="!relaventCommission">{{0 | currency:'USD'}}</span>
                                                            <span *ngIf="relaventCommission?.price_percentage==0">{{relaventCommission.commission_value  | currency:'USD'}}</span>  
                                                            <span *ngIf="relaventCommission?.price_percentage==1">{{(f['sub_total_amount'].value*relaventCommission.commission_value/100)  | currency:'USD' }}</span>  
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div> -->
                                    </div>
                                </form>  
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>